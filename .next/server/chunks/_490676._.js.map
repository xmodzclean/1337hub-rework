{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/lib/db.ts"],"sourcesContent":["// lib/prisma.ts\nimport { PrismaClient } from \"@prisma/client\";\n\nlet prisma: PrismaClient;\n\ndeclare global {\n  var prisma: PrismaClient;\n}\n\nif (process.env.NODE_ENV === \"production\") {\n  prisma = new PrismaClient();\n} else {\n  if (!globalThis.prisma) {\n    globalThis.prisma = new PrismaClient();\n  }\n  prisma = globalThis.prisma;\n}\n\nexport const db = prisma;\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;AAGhB,IAAI;AAMJ;;OAEO;IACL,IAAI,CAAC,WAAW,MAAM,EAAE;QACtB,WAAW,MAAM,GAAG,IAAI,uDAAA,CAAA,eAAY;IACtC;IACA,SAAS,WAAW,MAAM;AAC5B;AAEO,MAAM,KAAK"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 27, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/lib/authOptions.ts"],"sourcesContent":["import NextAuth from \"next-auth\";\nimport FortyTwoProvider from \"next-auth/providers/42-school\";\nimport type { NextAuthOptions } from \"next-auth\";\nimport { db } from \"../lib/db\";\n\nexport const authOptions: NextAuthOptions = {\n  secret: process.env.NEXT_AUTH_SECRET,\n  providers: [\n    FortyTwoProvider({\n      clientId: process.env.AUTH_42_SCHOOL_ID as string,\n      clientSecret: process.env.AUTH_42_SCHOOL_SECRET as string,\n    }),\n  ],\n  session: {\n    strategy: \"jwt\",\n    maxAge: 2 * 60 * 60, // 2 hours\n  },\n  callbacks: {\n    async signIn({ profile, user }: any) {\n      if (!profile || !user) return false;\n      // Allow BG, Khouribga, Med, Rabat\n      const allowedCampuses = [21, 16, 55, 75];\n      if (!allowedCampuses.includes(profile.campus[0].id)) return false;\n      return true;\n    },\n    async jwt({ token, account, profile }: any) {\n      if (profile) {\n        // console.log(profile);\n        token.accessToken = account?.access_token;\n        token.id = profile.id;\n        token.login = profile.login;\n        token.image = profile.image.versions.small;\n        token.main_cursus =\n          profile.cursus_users[profile.cursus_users.length - 1].cursus_id;\n        token.start_date =\n          profile.cursus_users[profile.cursus_users.length - 1].begin_at;\n        token.pool_year = profile.pool_year;\n        token.pool_month = profile.pool_month;\n        token.campus_id = profile.campus[0].id;\n        token.user_level =\n          profile.cursus_users[profile.cursus_users.length - 1].level;\n        if (!token.loginTime) {\n          token.loginTime = Date.now();\n        }\n        const dbUser = await db.user.findUnique({\n          where: { user_name: profile.login },\n        });\n        if (dbUser) {\n          token.verified = dbUser.is_verified;\n          token.banner_url = dbUser.banner_url;\n          token.nickname = dbUser.nickname;\n        } else {\n          const newUser = await db.user.create({\n            data: {\n              user_name: profile.login,\n              full_name: `${profile.first_name} ${profile.last_name}`,\n              curr_level: profile.cursus_users.at(-1).level,\n              last_level: profile.cursus_users.at(-1).level,\n              image_url: profile.image.versions.small,\n            },\n          });\n          token.verified = false;\n        }\n      }\n      return token;\n    },\n    async session({ session, token }: any) {\n      session.accessToken = token.accessToken;\n      session.user.id = token.id;\n      session.loginTime = token.loginTime;\n      session.user.login = token.login;\n      session.user.image = token.image;\n      session.user.main_cursus = token.main_cursus;\n      session.user.campus_id = token.campus_id;\n      session.user.start_year = token.start_date;\n      session.user.pool_year = Number(token.pool_year);\n      session.user.pool_month =\n        new Date(`${token.pool_month.toLowerCase()} 1, 2020`).getMonth() + 1;\n      session.user.user_level = token.user_level;\n      session.user.verified = token.verified;\n      session.user.banner_url = token.banner_url;\n      session.user.nickname = token.nickname;\n      return session;\n    },\n  },\n};\n\nexport default NextAuth(authOptions);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 123, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/app/api/students/update/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"../../../../../lib/authOptions\";\nimport { db } from \"../../../../../lib/db\";\n\nexport async function POST(req: NextRequest) {\n  // Get the NextAuth session\n  const session = await getServerSession({ req, ...authOptions });\n\n  if (!session) {\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n\n  // Extract and parse the body\n  const { nickname, bannerUrl, bio } = await req.json();\n\n  // checkers\n  if (nickname.length > 15 || (nickname.length < 3 && nickname != \"\")) {\n    return NextResponse.json(\n      { error: \"Nickname must be between 3 and 15 characters.\" },\n      { status: 400 }\n    );\n  }\n  if (!bannerUrl.startsWith(\"https://\") && bannerUrl !== \"\") {\n    return NextResponse.json(\n      { error: \"Banner URL must start with 'https://'.\" },\n      { status: 400 }\n    );\n  }\n  if (\n    !bannerUrl.endsWith(\".gif\") &&\n    !bannerUrl.endsWith(\".jpeg\") &&\n    !bannerUrl.endsWith(\".png\") &&\n    bannerUrl !== \"\"\n  ) {\n    return NextResponse.json(\n      { error: \"Banner URL must end with '.gif', '.jpeg', or '.png'.\" },\n      { status: 400 }\n    );\n  }\n  if (bio && bio.length > 500) {\n    return NextResponse.json(\n      { error: \"Bio must be 500 characters or less.\" },\n      { status: 400 }\n    );\n  }\n\n  const currentLevel = Number(session.user.user_level);\n\n  try {\n    // Get User from the database\n    const existingUser = await db.user.findUnique({\n      where: {\n        user_name: session.user.login as string,\n      },\n    });\n    if (!existingUser) {\n      return NextResponse.json({ error: \"User not found.\" }, { status: 404 });\n    }\n    // Check if the user's level has changed\n    const isLevelChanged = existingUser.curr_level !== currentLevel;\n    // Update the user in the database\n    const updatedUser = await db.user.update({\n      where: {\n        user_name: session.user.login as string,\n      },\n      data: {\n        curr_level: currentLevel,\n        last_level: isLevelChanged\n          ? existingUser.curr_level\n          : existingUser.last_level,\n        nickname: nickname as string,\n        banner_url: bannerUrl as string,\n        bio: bio ? bio.trim() : (existingUser as any).bio, // Update bio if provided, otherwise keep existing\n        is_verified: true,\n      } as any,\n    });\n\n    return NextResponse.json({ status: 200, user: updatedUser });\n  } catch (error) {\n    return NextResponse.json(\n      { error: \"Internal Server Error.\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAKO,eAAe,KAAK,GAAgB;IACzC,2BAA2B;IAC3B,MAAM,UAAU,MAAM,CAAA,GAAA,+IAAA,CAAA,mBAAgB,AAAD,EAAE;QAAE;QAAK,GAAG,oHAAA,CAAA,cAAW;IAAC;IAE7D,IAAI,CAAC,SAAS;QACZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IAEA,6BAA6B;IAC7B,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAG,EAAE,GAAG,MAAM,IAAI,IAAI;IAEnD,WAAW;IACX,IAAI,SAAS,MAAM,GAAG,MAAO,SAAS,MAAM,GAAG,KAAK,YAAY,IAAK;QACnE,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAgD,GACzD;YAAE,QAAQ;QAAI;IAElB;IACA,IAAI,CAAC,UAAU,UAAU,CAAC,eAAe,cAAc,IAAI;QACzD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyC,GAClD;YAAE,QAAQ;QAAI;IAElB;IACA,IACE,CAAC,UAAU,QAAQ,CAAC,WACpB,CAAC,UAAU,QAAQ,CAAC,YACpB,CAAC,UAAU,QAAQ,CAAC,WACpB,cAAc,IACd;QACA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuD,GAChE;YAAE,QAAQ;QAAI;IAElB;IACA,IAAI,OAAO,IAAI,MAAM,GAAG,KAAK;QAC3B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAsC,GAC/C;YAAE,QAAQ;QAAI;IAElB;IAEA,MAAM,eAAe,OAAO,QAAQ,IAAI,CAAC,UAAU;IAEnD,IAAI;QACF,6BAA6B;QAC7B,MAAM,eAAe,MAAM,2GAAA,CAAA,KAAE,CAAC,IAAI,CAAC,UAAU,CAAC;YAC5C,OAAO;gBACL,WAAW,QAAQ,IAAI,CAAC,KAAK;YAC/B;QACF;QACA,IAAI,CAAC,cAAc;YACjB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QACA,wCAAwC;QACxC,MAAM,iBAAiB,aAAa,UAAU,KAAK;QACnD,kCAAkC;QAClC,MAAM,cAAc,MAAM,2GAAA,CAAA,KAAE,CAAC,IAAI,CAAC,MAAM,CAAC;YACvC,OAAO;gBACL,WAAW,QAAQ,IAAI,CAAC,KAAK;YAC/B;YACA,MAAM;gBACJ,YAAY;gBACZ,YAAY,iBACR,aAAa,UAAU,GACvB,aAAa,UAAU;gBAC3B,UAAU;gBACV,YAAY;gBACZ,KAAK,MAAM,IAAI,IAAI,KAAK,AAAC,aAAqB,GAAG;gBACjD,aAAa;YACf;QACF;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;YAAK,MAAM;QAAY;IAC5D,EAAE,OAAO,OAAO;QACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF"}},
    {"offset": {"line": 227, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}