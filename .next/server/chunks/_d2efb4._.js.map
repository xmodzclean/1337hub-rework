{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/lib/db.ts"],"sourcesContent":["// lib/prisma.ts\nimport { PrismaClient } from \"@prisma/client\";\n\nlet prisma: PrismaClient;\n\ndeclare global {\n  var prisma: PrismaClient;\n}\n\nif (process.env.NODE_ENV === \"production\") {\n  prisma = new PrismaClient();\n} else {\n  if (!globalThis.prisma) {\n    globalThis.prisma = new PrismaClient();\n  }\n  prisma = globalThis.prisma;\n}\n\nexport const db = prisma;\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;AAGhB,IAAI;AAMJ;;OAEO;IACL,IAAI,CAAC,WAAW,MAAM,EAAE;QACtB,WAAW,MAAM,GAAG,IAAI,uDAAA,CAAA,eAAY;IACtC;IACA,SAAS,WAAW,MAAM;AAC5B;AAEO,MAAM,KAAK"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 27, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/lib/authOptions.ts"],"sourcesContent":["import NextAuth from \"next-auth\";\nimport FortyTwoProvider from \"next-auth/providers/42-school\";\nimport type { NextAuthOptions } from \"next-auth\";\nimport { db } from \"../lib/db\";\n\nexport const authOptions: NextAuthOptions = {\n  secret: process.env.NEXT_AUTH_SECRET,\n  providers: [\n    FortyTwoProvider({\n      clientId: process.env.AUTH_42_SCHOOL_ID as string,\n      clientSecret: process.env.AUTH_42_SCHOOL_SECRET as string,\n    }),\n  ],\n  session: {\n    strategy: \"jwt\",\n    maxAge: 2 * 60 * 60, // 2 hours\n  },\n  callbacks: {\n    async signIn({ profile, user }: any) {\n      if (!profile || !user) return false;\n      // Allow BG, Khouribga, Med, Rabat\n      const allowedCampuses = [21, 16, 55, 75];\n      if (!allowedCampuses.includes(profile.campus[0].id)) return false;\n      return true;\n    },\n    async jwt({ token, account, profile }: any) {\n      if (profile) {\n        // console.log(profile);\n        token.accessToken = account?.access_token;\n        token.id = profile.id;\n        token.login = profile.login;\n        token.image = profile.image.versions.small;\n        token.main_cursus =\n          profile.cursus_users[profile.cursus_users.length - 1].cursus_id;\n        token.start_date =\n          profile.cursus_users[profile.cursus_users.length - 1].begin_at;\n        token.pool_year = profile.pool_year;\n        token.pool_month = profile.pool_month;\n        token.campus_id = profile.campus[0].id;\n        token.user_level =\n          profile.cursus_users[profile.cursus_users.length - 1].level;\n        if (!token.loginTime) {\n          token.loginTime = Date.now();\n        }\n        const dbUser = await db.user.findUnique({\n          where: { user_name: profile.login },\n        });\n        if (dbUser) {\n          token.verified = dbUser.is_verified;\n          token.banner_url = dbUser.banner_url;\n          token.nickname = dbUser.nickname;\n        } else {\n          const newUser = await db.user.create({\n            data: {\n              user_name: profile.login,\n              full_name: `${profile.first_name} ${profile.last_name}`,\n              curr_level: profile.cursus_users.at(-1).level,\n              last_level: profile.cursus_users.at(-1).level,\n              image_url: profile.image.versions.small,\n            },\n          });\n          token.verified = false;\n        }\n      }\n      return token;\n    },\n    async session({ session, token }: any) {\n      session.accessToken = token.accessToken;\n      session.user.id = token.id;\n      session.loginTime = token.loginTime;\n      session.user.login = token.login;\n      session.user.image = token.image;\n      session.user.main_cursus = token.main_cursus;\n      session.user.campus_id = token.campus_id;\n      session.user.start_year = token.start_date;\n      session.user.pool_year = Number(token.pool_year);\n      session.user.pool_month =\n        new Date(`${token.pool_month.toLowerCase()} 1, 2020`).getMonth() + 1;\n      session.user.user_level = token.user_level;\n      session.user.verified = token.verified;\n      session.user.banner_url = token.banner_url;\n      session.user.nickname = token.nickname;\n      return session;\n    },\n  },\n};\n\nexport default NextAuth(authOptions);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 123, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/src/app/api/notifications/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"../../../../lib/authOptions\";\nimport { db } from \"../../../../lib/db\";\n\n// GET - Fetch user's notifications\nexport async function GET(req: NextRequest) {\n  const session = await getServerSession({ req, ...authOptions });\n  \n  if (!session) {\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n\n  try {\n    // Find user by login\n    const user = await db.user.findUnique({\n      where: { user_name: session.user.login },\n      select: { id: true },\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: \"User not found\" }, { status: 404 });\n    }\n\n    // Fetch notifications for the user\n    const notifications = await (db as any).notification.findMany({\n      where: { user_id: user.id },\n      orderBy: { created_at: \"desc\" },\n      take: 50, // Limit to 50 most recent notifications\n    });\n\n    // Count unread notifications\n    const unreadCount = await (db as any).notification.count({\n      where: { \n        user_id: user.id,\n        is_read: false \n      },\n    });\n\n    return NextResponse.json({ \n      notifications,\n      unreadCount \n    }, { status: 200 });\n    \n  } catch (error) {\n    console.error(\"Failed to fetch notifications:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch notifications.\" },\n      { status: 500 }\n    );\n  }\n}\n\n// PATCH - Mark notification(s) as read\nexport async function PATCH(req: NextRequest) {\n  const session = await getServerSession({ req, ...authOptions });\n  \n  if (!session) {\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n\n  const { notificationId, markAllAsRead } = await req.json();\n\n  try {\n    // Find user by login\n    const user = await db.user.findUnique({\n      where: { user_name: session.user.login },\n      select: { id: true },\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: \"User not found\" }, { status: 404 });\n    }\n\n    if (markAllAsRead) {\n      // Mark all notifications as read for this user\n      await (db as any).notification.updateMany({\n        where: { \n          user_id: user.id,\n          is_read: false \n        },\n        data: { is_read: true },\n      });\n    } else if (notificationId) {\n      // Mark specific notification as read\n      await (db as any).notification.updateMany({\n        where: { \n          id: notificationId,\n          user_id: user.id // Ensure user can only mark their own notifications\n        },\n        data: { is_read: true },\n      });\n    }\n\n    return NextResponse.json({ success: true }, { status: 200 });\n    \n  } catch (error) {\n    console.error(\"Failed to update notification:\", error);\n    return NextResponse.json(\n      { error: \"Failed to update notification.\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 269, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}